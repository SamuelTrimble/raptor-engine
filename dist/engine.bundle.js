!function(t){var i={};function s(e){if(i[e])return i[e].exports;var n=i[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=t,s.c=i,s.d=function(t,i,e){s.o(t,i)||Object.defineProperty(t,i,{enumerable:!0,get:e})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,i){if(1&i&&(t=s(t)),8&i)return t;if(4&i&&"object"==typeof t&&t&&t.__esModule)return t;var e=Object.create(null);if(s.r(e),Object.defineProperty(e,"default",{enumerable:!0,value:t}),2&i&&"string"!=typeof t)for(var n in t)s.d(e,n,function(i){return t[i]}.bind(null,n));return e},s.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(i,"a",i),i},s.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},s.p="",s(s.s=0)}([function(t,i,s){"use strict";s.r(i);var e=class{constructor(){}EaseInOutQuad(t,i,s,e){return(t/=e/2)<1?s/2*t*t+i:-s/2*(--t*(t-2)-1)+i}},n=class{constructor(t){if(!t)throw new Error("LoadingSpinner must be initialized with a valid 'canvas' element!");this._canvas=t,this._context=this._canvas.getContext("2d"),this._isRunning=!1,this._intervalTimer=null,this._filterStrength=20,this._frameTime=0,this._lastLoop=new Date,this._thisLoop=new Date,this._curFPS="N/A"}get running(){return this._isRunning}Start(){this._isRunning=!0,this._intervalTimer=setInterval(()=>{this._curFPS=(1e3/this._frameTime).toFixed(2)},1e3)}Stop(){this._isRunning=!1,clearInterval(this._intervalTimer),this._intervalTimer=null}Tick(){this._thisLoop=new Date;let t=this._thisLoop-this._lastLoop;this._frameTime+=(t-this._frameTime)/this._filterStrength,this._lastLoop=this._thisLoop}Render(){this._context.font="18px sans-serif",this._context.fillStyle="#000000",this._context.fillText("FPS: "+this._curFPS,7,21),this._context.fillStyle="#FFFFFF",this._context.fillText("FPS: "+this._curFPS,5,19)}},o=class{constructor(t=null,i={}){if(!t)throw new Error("LoadingSpinner must be initialized with a valid 'canvas' element!");this._canvas=t,this._context=this._canvas.getContext("2d"),this._spinCanvas=document.createElement("canvas"),this._spinContext=this._spinCanvas.getContext("2d"),this._spinCanvas.width=300,this._spinCanvas.height=300,this._state={opacity:0,fadingIn:!1,fadingOut:!1,curFrame:0},this._PI180=Math.PI/180,this._options={fillColor:"#000000",borderColor:"#F0F0F0",easingFunc:null},this._options={...this._options,...i}}set show(t){t&&0===this._state.opacity?this._state.fadingIn=!0:t||100!==this._state.opacity||(this._state.fadingOut=!0)}Render(){if(this._state.fadingIn&&(this._state.opacity+=5,this._state.opacity>=100&&(this._state.opacity=100,this._state.fadingIn=!1)),this._state.fadingOut&&(this._state.opacity-=5,this._state.opacity<=0&&(this._state.opacity=0,this._state.fadingOut=!1)),this._state.opacity>0){this._state.curFrame++,150===this._state.curFrame&&(this._state.curFrame=0),this._spinContext.setTransform(1,0,0,1,0,0),this._spinContext.clearRect(0,0,300,300),this._spinContext.globalAlpha=this._state.opacity/100;let t=45;(t=null!==this._options.easingFunc?this._options.easingFunc(this._state.curFrame,45,720,150):this._state.curFrame/150*720+45)>=360&&(t-=360),this._spinContext.translate(150,150),this._spinContext.rotate(this._PI180*t),this._spinContext.translate(-150,-150),this._spinContext.fillStyle=this._options.fillColor,this._spinContext.strokeStyle=this._options.borderColor,this._spinContext.lineWidth=2,this._spinContext.beginPath(),this._spinContext.moveTo(100,100),this._spinContext.lineTo(200,100),this._spinContext.lineTo(200,200),this._spinContext.lineTo(100,200),this._spinContext.closePath(),this._spinContext.fill(),this._spinContext.stroke();let i=(this._canvas.width-300)/2,s=(this._canvas.height-150)/2;this._context.drawImage(this._spinCanvas,i,s,300,150)}}},a=class{constructor(t={}){this._options={position:{x:0,y:0},pixelBounds:{x:0,y:0,w:0,h:0},state:{focused:!1,occupied:!1},texture:{}},this._options={...this._options,...t}}get x(){return this._options.position.x}get y(){return this._options.position.y}get bounds(){return this._options.pixelBounds}get focused(){return this._options.state.focused}set focused(t){this._options.state.focused=t}get occupied(){return this._options.state.occupied}set occupied(t){this._options.state.occupied=t}};const l={INFO:0,WARNING:1,ERROR:2};window.STL=window.STL||{},window.STL.DEBUGLEVEL=window.STL.DEBUGLEVEL||l,window.STL.RaptorEngine=window.STL.RaptorEngine||class{constructor(t=null,i={}){if(this._isRunning=!1,this._options={debugging:!1,debuggingLevel:l.WARNING,zoom:3,visibility:3,mapDataFile:"",mapBackgroundColor:"#000000",tileFocus:{x:0,y:0},tileDefaultColor:"#F0F0F0"},this._options={...this._options,...i},this._map={data:{},isBuilding:!1,tileSize:0,tileQuarterSize:0,tileHalfSize:0,tileDoubleSize:0,tilesW:0,tilesH:0,offsetX:0,pixelsW:0,pixelsH:0,tiles:[]},!t)throw this._Log(l.ERROR,"No 'canvas' specified!"),new Error("RaptorEngine must be initialized with a valid 'canvas' element!");""===this._options.mapDataFile&&this._Log(l.WARNING,"No 'mapDataFile' specified in the initialization options!"),this._canvas=t,this._context=this._canvas.getContext("2d"),this._fullCanvas=document.createElement("canvas"),this._fullContext=this._fullCanvas.getContext("2d"),this._canvasSize={},this._canvasSize.w=this._canvas.width=this._canvas.offsetWidth,this._canvasSize.h=this._canvas.height=this._canvas.offsetHeight,this._easing=new e,this._timer=null,this._options.debugging&&(this._timer=new n(t)),this._loadingSpinner=new o(t,{fillColor:this._options.mapBackgroundColor,borderColor:this._options.tileDefaultColor,easingFunc:this._easing.EaseInOutQuad}),this._Log(l.INFO,"Engine Initialized"),this._BuildMapLayout()}_Log(t,i){if(this._options.debugging&&this._options.debuggingLevel<=t)switch(t){case l.INFO:console.log("%cINFO: %c"+i,"font-weight:800;","font-weight:400;");break;case l.WARNING:console.log("%cWARNING: %c"+i,"font-weight:800;color:#A17727;","font-weight:400;");break;case l.ERROR:console.log("%cERROR: %c"+i,"font-weight:800;color:#A12727;","font-weight:400;")}}async _GetMapData(){try{let t=await fetch(this._options.mapDataFile,{method:"GET",headers:{"Content-type":"application/json"}}),i=await t.json();return this._map.data=i,!0}catch(t){return this._Log(l.ERROR,"Retrieving map data failed!"),this._Log(l.ERROR,t),!1}}async _BuildMapLayout(){if(this._Log(l.INFO,"Building map layout..."),this._map.isBuilding=!0,await this._GetMapData()){this._map.tileSize=this._map.data.tileSize,this._map.tileQuarterSize=this._map.tileSize/4,this._map.tileHalfSize=this._map.tileSize/2,this._map.tileDoubleSize=2*this._map.tileSize,this._map.tilesW=this._map.data.tileMap[0].length,this._map.tilesH=this._map.data.tileMap.length,this._map.offsetX=this._map.tilesW*this._map.tileSize,this._map.pixelsW=this._map.tilesW*this._map.tileSize+this._map.tileDoubleSize+this._map.offsetX,this._map.pixelsH=this._map.tilesH*this._map.tileSize+this._map.tileSize;for(let t=0;t<this._map.tiles.length;t++)this._map.tiles[t].length=0;this._map.tiles.length=0;for(let t=0;t<this._map.tilesH;t++){this._map.tiles.push([]);for(let i=0;i<this._map.tilesW;i++)if(1===this._map.data.tileMap[t][i]){let s=this._GridToPixels(i,t);this._map.tiles[t].push(new a({position:{x:i,y:t},pixelBounds:{x:s.x,y:s.y,w:this._map.tileDoubleSize,h:this._map.tileSize},state:{focused:i===this._options.tileFocus.x&&t===this._options.tileFocus.y}}))}else this._map.tiles[t].push(null)}this._fullCanvas.width=this._map.pixelsW,this._fullCanvas.height=this._map.pixelsH,this._fullContext.setTransform(1,0,0,1,0,0),this._fullContext.fillStyle=this._options.mapBackgroundColor,this._fullContext.fillRect(0,0,this._map.pixelsW,this._map.pixelsH),this._fullContext.fillStyle=this._options.tileDefaultColor,this._fullContext.strokeStyle=this._options.mapBackgroundColor,this._fullContext.lineWidth=2;for(let t=0;t<this._map.tilesH;t++)for(let i=0;i<this._map.tilesW;i++){let s=this._map.tiles[t][i];if(null!==s){let t=s.bounds.x,i=s.bounds.y;this._fullContext.beginPath(),this._fullContext.moveTo(t,i+this._map.tileHalfSize),this._fullContext.lineTo(t+this._map.tileSize,i),this._fullContext.lineTo(t+this._map.tileDoubleSize,i+this._map.tileHalfSize),this._fullContext.lineTo(t+this._map.tileSize,i+this._map.tileSize),this._fullContext.closePath(),this._fullContext.fill(),this._fullContext.stroke()}}this._map.isBuilding=!1,this._Log(l.INFO,"Finished building map layout.")}else this._map.isBuilding=!1}_GridToPixels(t,i){return{x:t*this._map.tileSize-i*this._map.tileSize+this._map.offsetX,y:t*this._map.tileHalfSize+i*this._map.tileHalfSize}}_RenderFrame(){if(this._context.fillStyle=this._options.mapBackgroundColor,this._context.fillRect(0,0,this._canvasSize.w,this._canvasSize.h),!this._map.isBuilding){let t=this._GridToPixels(this._options.tileFocus.x,this._options.tileFocus.y);t.x+=this._map.tileSize,t.y+=this._map.tileHalfSize;let i=1;switch(this._options.zoom){case 1:i=4;break;case 2:i=2;break;case 3:i=1;break;case 4:i=.5;break;case 5:i=.25;break;default:i=1}let s=t.x-this._canvasSize.w*i/2,e=t.y-this._canvasSize.h*i/2,n=this._canvasSize.w*i,o=this._canvasSize.h*i;this._context.drawImage(this._fullCanvas,s,e,n,o,0,0,this._canvasSize.w,this._canvasSize.h)}this._loadingSpinner.show=this._map.isBuilding,this._loadingSpinner.Render(),null!==this._timer&&(this._timer.Tick(),this._timer.Render()),this._isRunning&&requestAnimationFrame(this._RenderFrame.bind(this))}get position(){return this._options.tileFocus}get activeTile(){return this.TileAt(this._options.tileFocus.x,this._options.tileFocus.y)}get options(){return this._options}set options(t){let i=!1,s=this._options;this._options={...this._options,...t},this._options.mapDataFile!==s.mapDataFile&&(i=!0),i&&this._BuildMapLayout()}Start(){this._isRunning=!0,null!==this._timer&&this._timer.Start(),requestAnimationFrame(this._RenderFrame.bind(this))}Stop(){this._isRunning=!1,null!==this._timer&&this._timer.Stop()}}}]);